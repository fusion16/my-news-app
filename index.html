<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Khael's Media Update Tool v2</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
        }
        th {
            background-color: #f4f4f4;
        }
        .error {
            color: red;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Media Update Tool v2</h1>
    <form id="searchForm">
        <label for="keyword">Keyword:</label>
        <input type="text" id="keyword" placeholder="e.g., Malaysia" required>
        <br><br>
        <label for="startDate">Start Date:</label>
        <input type="date" id="startDate">
        <label for="endDate">End Date:</label>
        <input type="date" id="endDate">
        <br><br>
        <button type="submit">Search</button>
    </form>

    <div id="results"></div>

    <script>
        const rssFeeds = [
            { name: "Astro Awani", url: "https://www.astroawani.com/rss/latest/news.xml" },
            { name: "The Star", url: "https://www.thestar.com.my/rss/latest" },
            { name: "The Edge", url: "https://www.theedgemarkets.com/rss.xml" },
            { name: "Sinar Harian", url: "https://www.sinarharian.com.my/rss/latest" },
            { name: "Utusan Malaysia", url: "https://www.utusan.com.my/feed/" }
        ];

        document.getElementById("searchForm").addEventListener("submit", function (e) {
            e.preventDefault();
            const keyword = document.getElementById("keyword").value.toLowerCase();
            const startDate = new Date(document.getElementById("startDate").value);
            const endDate = new Date(document.getElementById("endDate").value);

            document.getElementById("results").innerHTML = "Loading...";
            let resultsHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Website</th>
                            <th>Title</th>
                            <th>Link</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            let feedCount = rssFeeds.length;

            rssFeeds.forEach(feed => {
                fetch(feed.url)
                    .then(response => {
                        if (!response.ok) throw new Error(`Error fetching ${feed.name}`);
                        return response.text();
                    })
                    .then(data => {
                        const parser = new DOMParser();
                        const xmlDoc = parser.parseFromString(data, "application/xml");
                        const items = xmlDoc.querySelectorAll("item");

                        items.forEach(item => {
                            const title = item.querySelector("title").textContent;
                            const link = item.querySelector("link").textContent;
                            const pubDate = item.querySelector("pubDate").textContent;
                            const description = item.querySelector("description")?.textContent || "";

                            const itemDate = new Date(pubDate);

                            // Filter by keyword and date range
                            if (
                                (title.toLowerCase().includes(keyword) || description.toLowerCase().includes(keyword)) &&
                                (!isNaN(startDate.getTime()) ? itemDate >= startDate : true) &&
                                (!isNaN(endDate.getTime()) ? itemDate <= endDate : true)
                            ) {
                                const date = itemDate.toLocaleDateString();
                                resultsHTML += `
                                    <tr>
                                        <td>${date}</td>
                                        <td>${feed.name}</td>
                                        <td>${title}</td>
                                        <td><a href="${link}" target="_blank">${link}</a></td>
                                    </tr>
                                `;
                            }
                        });
                    })
                    .catch(error => {
                        console.error(error);
                    })
                    .finally(() => {
                        feedCount--;
                        if (feedCount === 0) {
                            resultsHTML += `</tbody></table>`;
                            document.getElementById("results").innerHTML = resultsHTML || "No results found.";
                        }
                    });
            });
        });
    </script>
</body>
</html>
